<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Shopping List App</title>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <div class="nav-bar"></div>
    <div id="app">
      <div class="cart">
        <p>Cart: {{cart.length}}</p>
      </div>
      <product :cart="cart":premium="premium" @add-to-cart="updateCart" @remove-from-cart="removeItem"></product>
    </div>
    <script src="https://unpkg.com/vue"></script>
    <script>
    var eventBus = new Vue()
    Vue.component('product-review',{
      template:
      `
      <form class="review-form" @submit.prevent="onSubmit">
      <p v-if="errors.length">
      <b>Fill the following fields properly:</b>
      <ul>
        <li v-for="error in errors">{{error}}</li>
      </ul>
      </p>
      <p>
        <label for="name">Name:</label>
        <input v-model="name">
      </p>
      <p>
        <label for="review">Review</label>
        <textarea id="review" v-model="review"></textarea>
      </p>
      <p>
        <label for="rating">Rating</label>
        <select id="rating" v-model.number="rating">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        </select>
      </p>
      <button type="submit">Submit</button>
      </form>
      `,
      data() {
        return {
          name: null,
          review: null,
          rating: null,
          errors: []
        }
      },
      methods: {
        onSubmit(){
          this.errors = []
          if (this.name && this.review && this.rating) {
            let productReview = {
              name: this.name,
              review: this.review,
              rating: this.rating
            }
            eventBus.$emit('review-submitted', productReview)
            this.name = null
            this.review = null
            this.rating = null

          }else{
            if (!this.name) {
              this.errors.push("Name Required.")
            }
            if (!this.review) {
              this.errors.push("Review Required.")
            }
            if (!this.rating) {
              this.errors.push("Rating Required.")
            }
          }
        }
      }
    }),
    Vue.component('product', {
      props: {
        premium: {
          type: Boolean,
          required: true
        },
        cart: {
          type: Array,
          required: true,
          default: 0
        }
      },
      template:
      `
      <div class="product">
        <div class="product-image">
          <img :src="image">
        </div>
        <div class="product-info">
          <h1>{{ title }}</h1>
          <p v-if="inStock">In Stock</p>
          <p v-else>Out of Stock</p>
          <p> Shipping: {{shipping}}</p>

          <ul>
            <li v-for="detail in details">{{detail}}</li>
          </ul>
          <div v-for="(variant, index) in variants"
            :key="variant.variantId"
            class="color-box"
            :style="{backgroundColor: variant.variantColor}"
            @mouseover="changeImg(index)">
          </div>
          <button @click="addToCart()"
                  :disabled="!inStock"
                  :class="{disabledButton: !inStock}">
          Add to Cart</button>
          <button v-if="cart.length > 0" @click="removeFromCart()">Remove Item</button>
        </div>
        <product-tabs :reviews="reviews"></product-tabs>
      </div>
      `,
      data() {
        return{
          brand: 'Vue Mastery',
          product: 'Socks',
          selectedVariant: 0,
          //image: './vmSocks-green.jpg',
          details: ["80% cotton", "20% polyester", "Gender-neutral"],
          variants:
          [
            {
              variantId: 2234,
              variantColor: "green",
              variantImage: './vmSocks-green.jpg',
              variantQuantity: 10,
            },
            {
              variantId: 2235,
              variantColor: "blue",
              variantImage: './vmSocks-blue.jpg',
              variantQuantity: 0,
            }
          ],
          reviews: []
        }
      },
      methods: {
        addToCart(){
          this.$emit('add-to-cart', this.variants[this.selectedVariant].variantId)
          this.variants[this.selectedVariant].variantQuantity --
        },
        removeFromCart(){
          this.$emit('remove-from-cart')
          this.variants[this.selectedVariant].variantQuantity ++
        },
        changeImg(index){
          this.selectedVariant = index
        },
      },
      computed: {
        title() {
          return this.brand + ' ' + this.product
        },
        image(){
          return this.variants[this.selectedVariant].variantImage
        },
        inStock(){
          return this.variants[this.selectedVariant].variantQuantity
        },
        shipping(){
          if (this.premium) {
            return 'Free'
          }else{
            return 2.99
          }
        }
      },
      mounted(){
        eventBus.$on('review-submitted', productReview =>{
          this.reviews.push(productReview)
        })
      }
    }
  )
  Vue.component('product-tabs', {
    props: {
      reviews: {
        type: Array,
        required: true
      }
    },
    template:
    `<div>
      <span class="tab"
            :class="{ activeTab: selectedTab === tab}"
            v-for="(tab, index) in tabs" :key="index"
            @click="selectedTab = tab">
              {{tab}}
            </span>
            <div v-show="selectedTab === 'Reviews'">
              <h2>Reviews</h2>
              <p v-if="reviews.length">
                <ul>
                  <li v-for="review in reviews">
                    <p>{{review.name}}</p>
                    <p>Rating: {{review.rating}}</p>
                    <p>\"{{review.review}}\"</p>
                  </li>
                </ul>
              </p>
              <p v-else>There are no reviews yet</p>
            </div>
            <product-review v-show="selectedTab === 'Make a Review'"></product-review>
    </div>
    `,
    data(){
      return {
        tabs: ['Reviews', 'Make a Review'],
        selectedTab: 'Reviews'
      }
    }
  })
      var app = new Vue({
        el: '#app',
        data: {
          premium: true,
          cart: [

          ]
        },
        methods: {
          updateCart(id){
            this.cart.push(id)
          },
          removeItem(id) {
          this.cart.pop()
        }
        }
      })
    </script>
  </body>
</html>
